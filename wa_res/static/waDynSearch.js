importScripts("intuisphere_ft_search.js"),onmessage=function(r){var e=r.data[0],e=(e.code,e.param),e=new SearchWorker(e).loadJson();postMessage([e])};class SearchWorker{constructor(r){this.m_restriction_keys=r.restriction_keys,this.m_json_index=r.json_index,this.m_context_search=r.context_search,this.m_query=this.m_context_search.m_query}loadJson(){var e=this,t={success:!1,search_results:[]},r=new XMLHttpRequest;return r.onreadystatechange=function(){var r;4==this.readyState&&200==this.status&&(r=JSON.parse(this.responseText),t.search_results=e.doSearch(r),t.success=!0)},r.onerror=function(){console.log("** An error occurred during the search json loading")},r.open("GET",this.m_json_index,!1),r.send(),t.context_search=this.m_context_search,t}doSearch(r){for(var _=IntuisphereFtSearch.OPERATOR_AND,u=IntuisphereFtSearch.splitQuery(this.m_query),e=[],t=0;t<u.length;t++){var l=u[t].trim();if(0<l.length){for(var S=[],d=this.doSearchWithWord(r,l),s=0;s<d.length;s++)var m=d[s],m=r.index_words[m],S=S.concat(m);var a=Array.from(new Set(S)),e=_==IntuisphereFtSearch.OPERATOR_AND?0==t?a:e.filter(r=>a.includes(r)):e.concat(a)}}_==IntuisphereFtSearch.OPERATOR_OR&&(e=Array.from(new Set(e)));for(var n=[],h=0;h<e.length;h++){var o=e[h];if(0==(T=r.map_targets[o]).is_page)for(var p=r.map_widget_pages[o],i=0;i<p.length;i++){var W=p[i];n.push(W)}else n.push(o)}for(var n=Array.from(new Set(n)),c=[],g=0;g<n.length;g++){var o=n[g],T=r.map_targets[o];c.push(T)}return c=0<this.m_restriction_keys.length?c.filter(r=>this.m_restriction_keys.includes(r)):c}internal_almostMatch(r,e){var t=r.length,s=e.length;if(Math.abs(t-s)<3){t=Math.min(t,s);if(2<t&&(r=r.substring(0,t))==(e=e.substring(0,t)))return!0}return!1}internal_compareWord(r,e,t){return t==SearchWorker.CMP_EXACT_MATCH?r==e:t==SearchWorker.CMP_STARTS_WITH&&r.startsWith(e)}internal_CreateSearchResultsWithWord(r,e,t){for(var s=[],a=r.map_words,n=0;n<a.length;n++){var h=a[n];this.internal_compareWord(h,e,t)&&s.push(n)}return s}doSearchWithWord(r,e){var t=this.internal_CreateSearchResultsWithWord(r,e,SearchWorker.CMP_EXACT_MATCH),s=this.internal_CreateSearchResultsWithWord(r,e,SearchWorker.CMP_STARTS_WITH);return t=Array.from(new Set(t.concat(s)))}}SearchWorker.CMP_ALMOST_MATCH=1,SearchWorker.CMP_EXACT_MATCH=2,SearchWorker.CMP_STARTS_WITH=3;